<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Phishing Detection Game</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  color: #fff;
  padding: 20px;
}

.container {
  max-width: 700px;
  width: 100%;
}

header {
  text-align: center;
  margin-bottom: 30px;
}

h1 {
  font-size: 2.5em;
  margin-bottom: 10px;
  text-shadow: 2px 2px 10px rgba(0, 255, 255, 0.5);
}

.subtitle {
  font-size: 1.1em;
  color: #00d4ff;
  opacity: 0.9;
}

/* High Score Display */
.high-score-display {
  text-align: center;
  background: rgba(255, 215, 0, 0.1);
  border: 2px solid rgba(255, 215, 0, 0.3);
  padding: 12px 20px;
  border-radius: 10px;
  margin-bottom: 20px;
  backdrop-filter: blur(10px);
}

.high-score-display span {
  color: #FFD700;
  font-weight: bold;
  font-size: 1.2em;
}

/* Start Screen */
.start-screen {
  text-align: center;
  background: rgba(255, 255, 255, 0.15);
  backdrop-filter: blur(20px);
  border-radius: 20px;
  padding: 50px 40px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  border: 1px solid rgba(255, 255, 255, 0.2);
  animation: fadeIn 0.5s ease;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.start-screen h2 {
  font-size: 2.2em;
  margin-bottom: 15px;
  color: #00d4ff;
}

.start-screen p {
  font-size: 1.2em;
  margin-bottom: 35px;
  color: #e0e0e0;
}

.difficulty-buttons {
  display: flex;
  flex-direction: column;
  gap: 15px;
  margin-bottom: 20px;
}

.btn-difficulty {
  padding: 18px 40px;
  font-size: 1.3em;
  font-weight: bold;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
  text-transform: uppercase;
  position: relative;
  overflow: hidden;
}

.btn-difficulty:before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.2);
  transform: translate(-50%, -50%);
  transition: width 0.5s, height 0.5s;
}

.btn-difficulty:hover:before {
  width: 300px;
  height: 300px;
}

.btn-difficulty span {
  position: relative;
  z-index: 1;
}

.btn-easy {
  background: linear-gradient(135deg, #00ff88, #00cc66);
  color: #003322;
}

.btn-easy:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 20px rgba(0, 255, 136, 0.4);
}

.btn-medium {
  background: linear-gradient(135deg, #ffa500, #ff8800);
  color: #fff;
}

.btn-medium:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 20px rgba(255, 165, 0, 0.4);
}

.btn-hard {
  background: linear-gradient(135deg, #ff4444, #cc0000);
  color: #fff;
}

.btn-hard:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 20px rgba(255, 68, 68, 0.4);
}

.difficulty-info {
  font-size: 0.9em;
  color: #aaa;
  margin-top: 10px;
}

.game-info {
  display: flex;
  justify-content: space-between;
  margin-bottom: 20px;
  background: rgba(255, 255, 255, 0.1);
  padding: 15px 20px;
  border-radius: 10px;
  backdrop-filter: blur(10px);
  flex-wrap: wrap;
  gap: 10px;
}

.score, .timer, .progress, .difficulty-label {
  font-size: 1.2em;
  font-weight: bold;
}

.score span, .timer span, .progress span {
  color: #00ff88;
}

.difficulty-label span {
  color: #00d4ff;
}

.timer.warning span {
  color: #ff4444;
  animation: pulse 0.5s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.email-card {
  background: rgba(255, 255, 255, 0.15);
  backdrop-filter: blur(20px);
  border-radius: 15px;
  padding: 30px;
  margin-bottom: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: opacity 0.3s ease;
}

.email-header {
  border-bottom: 2px solid rgba(255, 255, 255, 0.2);
  padding-bottom: 15px;
  margin-bottom: 15px;
}

.email-subject {
  font-size: 1.4em;
  font-weight: bold;
  margin-bottom: 10px;
  color: #00d4ff;
}

.email-from {
  font-size: 1em;
  color: #aaa;
  margin-bottom: 5px;
}

.email-from span {
  color: #fff;
  font-weight: bold;
}

.email-body {
  font-size: 1.1em;
  line-height: 1.6;
  color: #e0e0e0;
  margin-top: 15px;
}

.buttons {
  display: flex;
  gap: 20px;
  justify-content: center;
  margin-top: 30px;
}

button {
  padding: 15px 40px;
  font-size: 1.2em;
  font-weight: bold;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
  text-transform: uppercase;
}

button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none !important;
}

.btn-legit {
  background: linear-gradient(135deg, #00ff88, #00cc66);
  color: #003322;
}

.btn-legit:hover:not(:disabled) {
  transform: translateY(-3px);
  box-shadow: 0 6px 20px rgba(0, 255, 136, 0.4);
}

.btn-legit:active:not(:disabled) {
  transform: translateY(0);
}

.btn-phishing {
  background: linear-gradient(135deg, #ff4444, #cc0000);
  color: #fff;
}

.btn-phishing:hover:not(:disabled) {
  transform: translateY(-3px);
  box-shadow: 0 6px 20px rgba(255, 68, 68, 0.4);
}

.btn-phishing:active:not(:disabled) {
  transform: translateY(0);
}

.feedback {
  text-align: center;
  font-size: 1.3em;
  font-weight: bold;
  margin-top: 15px;
  min-height: 30px;
  animation: fadeIn 0.3s ease;
}

.feedback.correct {
  color: #00ff88;
}

.feedback.wrong {
  color: #ff4444;
}

/* Explanation Panel */
.explanation-panel {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(15px);
  border-radius: 12px;
  padding: 25px;
  margin-top: 20px;
  border: 2px solid rgba(255, 255, 255, 0.3);
  animation: slideIn 0.4s ease;
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.explanation-panel.correct {
  border-color: #00ff88;
  background: rgba(0, 255, 136, 0.1);
}

.explanation-panel.wrong {
  border-color: #ff4444;
  background: rgba(255, 68, 68, 0.1);
}

.explanation-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 15px;
  font-size: 1.3em;
  font-weight: bold;
}

.explanation-icon {
  font-size: 1.5em;
}

.explanation-title {
  color: #00d4ff;
  font-size: 1.2em;
  margin-bottom: 15px;
  font-weight: bold;
}

.explanation-list {
  list-style: none;
  padding: 0;
}

.explanation-list li {
  padding: 10px 0;
  padding-left: 30px;
  position: relative;
  font-size: 1.05em;
  line-height: 1.5;
  color: #e0e0e0;
}

.explanation-list li:before {
  content: "‚Ä¢";
  position: absolute;
  left: 10px;
  color: #00d4ff;
  font-size: 1.5em;
}

.btn-next {
  margin-top: 20px;
  background: linear-gradient(135deg, #00d4ff, #0099cc);
  color: #fff;
  padding: 12px 35px;
  font-size: 1.1em;
  border-radius: 8px;
  cursor: pointer;
  border: none;
  transition: all 0.3s ease;
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.btn-next:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 20px rgba(0, 212, 255, 0.4);
}

.btn-next:active {
  transform: translateY(0);
}

/* Game Over Screen */
.game-over {
  text-align: center;
  background: rgba(255, 255, 255, 0.15);
  backdrop-filter: blur(20px);
  border-radius: 15px;
  padding: 40px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  border: 1px solid rgba(255, 255, 255, 0.2);
  animation: fadeIn 0.5s ease;
}

.game-over h2 {
  font-size: 2.5em;
  margin-bottom: 20px;
  color: #00d4ff;
}

.final-score {
  font-size: 2em;
  margin: 20px 0;
  color: #00ff88;
}

.rank-message {
  font-size: 1.5em;
  margin: 20px 0;
  padding: 20px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 10px;
}

.new-high-score {
  background: rgba(255, 215, 0, 0.2);
  border: 2px solid #FFD700;
  padding: 20px;
  border-radius: 10px;
  margin: 20px 0;
  animation: glow 1s ease-in-out infinite;
}

@keyframes glow {
  0%, 100% {
    box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
  }
  50% {
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
  }
}

.new-high-score h3 {
  color: #FFD700;
  font-size: 1.8em;
  margin-bottom: 15px;
}

.name-input {
  padding: 12px 20px;
  font-size: 1.1em;
  border: 2px solid #00d4ff;
  border-radius: 8px;
  background: rgba(255, 255, 255, 0.1);
  color: #fff;
  text-align: center;
  width: 80%;
  max-width: 300px;
  margin: 10px 0;
}

.name-input::placeholder {
  color: rgba(255, 255, 255, 0.5);
}

.btn-save-score {
  margin-top: 15px;
  background: linear-gradient(135deg, #FFD700, #FFA500);
  color: #000;
  padding: 12px 30px;
  font-size: 1.1em;
  border-radius: 8px;
  cursor: pointer;
  border: none;
  transition: all 0.3s ease;
  font-weight: bold;
}

.btn-save-score:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
}

.btn-restart {
  margin-top: 30px;
  background: linear-gradient(135deg, #00d4ff, #0099cc);
  color: #fff;
  padding: 15px 50px;
  font-size: 1.2em;
  border-radius: 10px;
  cursor: pointer;
  border: none;
  transition: all 0.3s ease;
}

.btn-restart:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 20px rgba(0, 212, 255, 0.4);
}

.hidden {
  display: none;
}

.fade-out {
  opacity: 0;
}

@media (max-width: 600px) {
  h1 {
    font-size: 2em;
  }
  
  .game-info {
    font-size: 0.9em;
  }
  
  .buttons {
    flex-direction: column;
  }
}
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>üîí Phishing Detection Game</h1>
    <p class="subtitle">Can you spot the phishing emails?</p>
  </header>

  <!-- High Score Display -->
  <div id="highScoreDisplay" class="high-score-display hidden">
    üèÜ High Score: <span id="highScoreValue">0</span> (<span id="highScoreName">Unknown</span>)
  </div>

  <!-- Start Screen -->
  <div id="startScreen" class="start-screen">
    <h2>Phishing Detection Challenge</h2>
    <p>Test your skills at identifying phishing emails!</p>
    <div class="difficulty-buttons">
      <button class="btn-difficulty btn-easy" data-difficulty="easy">
        <span>üü¢ Easy</span>
      </button>
      <div class="difficulty-info">30 seconds per email ‚Ä¢ Basic phishing attempts</div>
      
      <button class="btn-difficulty btn-medium" data-difficulty="medium">
        <span>üü° Medium</span>
      </button>
      <div class="difficulty-info">20 seconds per email ‚Ä¢ Moderate difficulty</div>
      
      <button class="btn-difficulty btn-hard" data-difficulty="hard">
        <span>üî¥ Hard</span>
      </button>
      <div class="difficulty-info">10 seconds per email ‚Ä¢ Expert level challenges</div>
    </div>
  </div>

  <!-- Game Screen -->
  <div id="gameScreen" class="hidden">
    <div class="game-info">
      <div class="score">Score: <span id="scoreValue">0</span></div>
      <div class="difficulty-label">Level: <span id="difficultyDisplay">Easy</span></div>
      <div class="progress">Email: <span id="emailProgress">1/4</span></div>
      <div class="timer" id="timer">Time: <span id="timeValue">30</span>s</div>
    </div>

    <div class="email-card" id="emailCard">
      <div class="email-header">
        <div class="email-subject" id="emailSubject"></div>
        <div class="email-from">From: <span id="emailFrom"></span></div>
      </div>
      <div class="email-body" id="emailBody"></div>
    </div>

    <div class="buttons">
      <button class="btn-legit" id="btnLegit">‚úÖ Legit</button>
      <button class="btn-phishing" id="btnPhishing">‚ùå Phishing</button>
    </div>

    <div class="feedback" id="feedback"></div>

    <div id="explanationPanel" class="hidden"></div>
  </div>

  <!-- Game Over Screen -->
  <div id="gameOverScreen" class="game-over hidden">
    <h2>üéØ Game Over!</h2>
    <div class="final-score">Final Score: <span id="finalScore">0</span></div>
    <div class="rank-message" id="rankMessage"></div>
    
    <!-- New High Score Section -->
    <div id="newHighScoreSection" class="new-high-score hidden">
      <h3>üéä New High Score! üéä</h3>
      <p>Enter your name to save your score:</p>
      <input type="text" id="nameInput" class="name-input" placeholder="Your Name" maxlength="20">
      <br>
      <button class="btn-save-score" id="btnSaveScore">Save Score</button>
    </div>
    
    <button class="btn-restart" id="btnRestart">üîÑ Play Again</button>
  </div>
</div>

<script>
// ============================================
// EMAIL DATABASE WITH DIFFICULTY LEVELS
// ============================================
const emails = [
  // EASY EMAILS
  {
    subject: "You've won $1,000,000!!!",
    from: "winner@lottery-claim-center.net",
    body: "CONGRATULATIONS! You have been randomly selected as the winner of our international lottery! To claim your prize of $1,000,000, please provide your bank account details, social security number, and a processing fee of $500. Act now before this offer expires!",
    isPhishing: true,
    difficulty: "easy",
    explanation: [
      "Too good to be true - unsolicited lottery winnings",
      "Requests sensitive personal information (SSN, bank details)",
      "Asks for money upfront to claim a 'prize'",
      "Excessive use of caps and exclamation marks"
    ]
  },
  {
    subject: "Team Meeting Reminder - Tomorrow 10 AM",
    from: "hr@company.com",
    body: "Hi team, This is a reminder that we have our weekly team meeting scheduled for tomorrow at 10:00 AM in Conference Room B. Please review the agenda attached and come prepared with your project updates. See you there!",
    isPhishing: false,
    difficulty: "easy",
    explanation: [
      "Comes from legitimate company domain",
      "Professional and friendly tone without urgency",
      "No suspicious links or requests for sensitive information",
      "Specific details like meeting time and location"
    ]
  },
  {
    subject: "Your package could not be delivered",
    from: "delivery@fedx-express.com",
    body: "We attempted to deliver your package but no one was available. To reschedule delivery, please confirm your address and pay a $3.99 redelivery fee by clicking the link below. Your package will be returned if not claimed within 48 hours.",
    isPhishing: true,
    difficulty: "easy",
    explanation: [
      "Misspelled domain 'fedx' instead of 'fedex'",
      "Unexpected delivery fee for a package you didn't order",
      "Creates urgency with 48-hour deadline",
      "Legitimate carriers don't ask for payment via email links"
    ]
  },
  {
    subject: "Monthly Newsletter - April 2024",
    from: "newsletter@techcompany.com",
    body: "Welcome to our April newsletter! This month we're featuring new product updates, upcoming webinars, and industry insights. Check out our latest blog post about cybersecurity best practices. You can unsubscribe anytime from your account settings.",
    isPhishing: false,
    difficulty: "easy",
    explanation: [
      "Legitimate company newsletter from official domain",
      "No urgent calls to action or threats",
      "Provides unsubscribe option (required by law)",
      "Informational content without requesting personal data"
    ]
  },

  // MEDIUM EMAILS
  {
    subject: "Urgent! Verify your bank account",
    from: "support@secure-bank-login.com",
    body: "Dear customer, Your account has been temporarily suspended due to suspicious activity. Click here immediately to verify your identity and restore access. Failure to do so within 24 hours will result in permanent account closure.",
    isPhishing: true,
    difficulty: "medium",
    explanation: [
      "Suspicious domain 'secure-bank-login.com' - not an official bank domain",
      "Creates urgency and fear to pressure you into acting quickly",
      "Generic greeting 'Dear customer' instead of using your name",
      "Threatens account closure to manipulate you"
    ]
  },
  {
    subject: "Invoice #45821 - Payment Confirmation",
    from: "accounts@vendor.com",
    body: "Thank you for your recent purchase. Your payment of $299.00 has been processed successfully. Please find attached your invoice for order #45821. If you have any questions, contact our support team at support@vendor.com.",
    isPhishing: false,
    difficulty: "medium",
    explanation: [
      "Professional business communication",
      "Provides specific order and invoice numbers",
      "Legitimate support contact information",
      "No urgent demands or suspicious requests"
    ]
  },
  {
    subject: "ACTION REQUIRED: Update Payment Information",
    from: "billing@paypa1-secure.com",
    body: "We noticed an issue with your payment method. Your PayPal account will be limited unless you update your information immediately. Click the link below to verify your credit card details and avoid service interruption.",
    isPhishing: true,
    difficulty: "medium",
    explanation: [
      "Domain uses number '1' instead of letter 'l' in PayPal - classic phishing trick",
      "Creates false urgency about account limitation",
      "Requests sensitive payment information",
      "Real PayPal would never ask for this via email"
    ]
  },
  {
    subject: "Weekly Report - Q1 Results",
    from: "analytics@company.com",
    body: "Hello, Please find attached the weekly analytics report for Q1. Our team has seen a 15% increase in user engagement this quarter. The detailed breakdown is available in the attached PDF. Let me know if you need any clarification.",
    isPhishing: false,
    difficulty: "medium",
    explanation: [
      "Internal company communication from verified domain",
      "Professional business language",
      "Specific data and metrics included",
      "No suspicious links or requests for personal information"
    ]
  },

  // HARD EMAILS
  {
    subject: "Security Alert: New login from unknown device",
    from: "no-reply@app1e-security.com",
    body: "We detected a login to your Apple ID from a device we don't recognize. If this wasn't you, your account may be compromised. Click here to secure your account immediately and change your password. Location: Russia. Device: Windows PC.",
    isPhishing: true,
    difficulty: "hard",
    explanation: [
      "Domain uses number '1' instead of letter 'l' in Apple - subtle trick",
      "Fake security alert to create panic",
      "Suspicious login location designed to scare you",
      "Real Apple security alerts come through official app notifications"
    ]
  },
  {
    subject: "Your subscription renewal confirmation",
    from: "subscriptions@streamingservice.com",
    body: "Hi there! Your monthly subscription has been successfully renewed for $12.99. Your next billing date is May 15, 2024. You can manage your subscription settings anytime from your account dashboard. Thanks for being a valued member!",
    isPhishing: false,
    difficulty: "hard",
    explanation: [
      "Legitimate subscription confirmation",
      "Specific pricing and billing date information",
      "No requests for payment or personal information",
      "Directs to account dashboard for changes (not external link)"
    ]
  },
  {
    subject: "RE: Document Review Required",
    from: "cfo@companylnc.com",
    body: "Hi, I need you to review this contract before our meeting at 3pm today. It's urgent and confidential. I'm in meetings all day so can't call. Please download the document from this secure link and send your approval ASAP. Thanks!",
    isPhishing: true,
    difficulty: "hard",
    explanation: [
      "Domain uses 'lnc' instead of 'Inc' - very subtle typo",
      "Creates urgency and time pressure",
      "Claims sender is unavailable to verify (red flag)",
      "Requests immediate action on 'confidential' document"
    ]
  },
  {
    subject: "Expense Report Approved - March 2024",
    from: "finance@company.com",
    body: "Your expense report for March 2024 has been approved. Total reimbursement: $847.32. The amount will be deposited to your account within 3-5 business days. View detailed breakdown in the finance portal. Contact finance@company.com with questions.",
    isPhishing: false,
    difficulty: "hard",
    explanation: [
      "Legitimate internal company email",
      "Specific dollar amount and timeframe",
      "Directs to company portal (not external link)",
      "Provides legitimate contact information"
    ]
  }
];

// ============================================
// GAME STATE VARIABLES
// ============================================
let currentScore = 0;
let currentEmailIndex = 0;
let filteredEmails = [];
let timeLeft = 30;
let timerInterval;
let buttonsEnabled = true;
let selectedDifficulty = 'easy';
let timerDuration = 30;

// ============================================
// DOM ELEMENTS
// ============================================
const highScoreDisplay = document.getElementById('highScoreDisplay');
const highScoreValue = document.getElementById('highScoreValue');
const highScoreName = document.getElementById('highScoreName');
const startScreen = document.getElementById('startScreen');
const scoreValue = document.getElementById('scoreValue');
const emailProgress = document.getElementById('emailProgress');
const timeValue = document.getElementById('timeValue');
const timerElement = document.getElementById('timer');
const difficultyDisplay = document.getElementById('difficultyDisplay');
const emailSubject = document.getElementById('emailSubject');
const emailFrom = document.getElementById('emailFrom');
const emailBody = document.getElementById('emailBody');
const emailCard = document.getElementById('emailCard');
const feedback = document.getElementById('feedback');
const btnLegit = document.getElementById('btnLegit');
const btnPhishing = document.getElementById('btnPhishing');
const gameScreen = document.getElementById('gameScreen');
const gameOverScreen = document.getElementById('gameOverScreen');
const finalScore = document.getElementById('finalScore');
const rankMessage = document.getElementById('rankMessage');
const btnRestart = document.getElementById('btnRestart');
const explanationPanel = document.getElementById('explanationPanel');
const newHighScoreSection = document.getElementById('newHighScoreSection');
const nameInput = document.getElementById('nameInput');
const btnSaveScore = document.getElementById('btnSaveScore');

// ============================================
// HIGH SCORE MANAGEMENT
// ============================================

/**
 * Load high score from localStorage
 * Returns the saved score data or null if none exists
 */
function loadHighScore() {
  const savedScore = localStorage.getItem('phishingGameHighScore');
  if (savedScore) {
    const scoreData = JSON.parse(savedScore);
    highScoreValue.textContent = scoreData.score;
    highScoreName.textContent = scoreData.name;
    highScoreDisplay.classList.remove('hidden');
    return scoreData;
  }
  return null;
}

/**
 * Save high score to localStorage
 * Only saves if score is higher than existing high score
 */
function saveHighScore(name, score) {
  const scoreData = {
    name: name || 'Anonymous',
    score: score
  };
  localStorage.setItem('phishingGameHighScore', JSON.stringify(scoreData));
  highScoreValue.textContent = score;
  highScoreName.textContent = scoreData.name;
  highScoreDisplay.classList.remove('hidden');
}

/**
 * Check if current score beats the high score
 */
function isNewHighScore(score) {
  const currentHighScore = loadHighScore();
  return !currentHighScore || score > currentHighScore.score;
}

// ============================================
// DIFFICULTY SELECTION
// ============================================

/**
 * Handle difficulty button clicks
 * Set timer duration based on difficulty and start game
 */
document.querySelectorAll('.btn-difficulty').forEach(btn => {
  btn.addEventListener('click', (e) => {
    selectedDifficulty = e.currentTarget.dataset.difficulty;
    
    // Set timer duration based on difficulty
    switch(selectedDifficulty) {
      case 'easy':
        timerDuration = 30;
        break;
      case 'medium':
        timerDuration = 20;
        break;
      case 'hard':
        timerDuration = 10;
        break;
    }
    
    // Update difficulty display
    difficultyDisplay.textContent = selectedDifficulty.charAt(0).toUpperCase() + selectedDifficulty.slice(1);
    
    // Start game
    startGame();
  });
});

// ============================================
// GAME FUNCTIONS
// ============================================

/**
 * Filter and shuffle emails based on selected difficulty
 */
function prepareEmails() {
  // Filter emails by selected difficulty
  const emailsByDifficulty = emails.filter(email => email.difficulty === selectedDifficulty);
  
  // Shuffle the filtered emails
  filteredEmails = [...emailsByDifficulty];
  for (let i = filteredEmails.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [filteredEmails[i], filteredEmails[j]] = [filteredEmails[j], filteredEmails[i]];
  }
}

/**
 * Initialize and start the game
 */
function startGame() {
  currentScore = 0;
  currentEmailIndex = 0;
  prepareEmails();
  updateScore();
  
  // Hide start screen, show game screen
  startScreen.classList.add('hidden');
  gameScreen.classList.remove('hidden');
  
  showEmail();
}

/**
 * Display the current email
 */
function showEmail() {
  if (currentEmailIndex >= filteredEmails.length) {
    endGame();
    return;
  }

  buttonsEnabled = true;
  btnLegit.disabled = false;
  btnPhishing.disabled = false;
  
  const email = filteredEmails[currentEmailIndex];
  
  // Hide explanation panel
  explanationPanel.classList.add('hidden');
  explanationPanel.innerHTML = '';
  
  // Fade in animation
  emailCard.classList.add('fade-out');
  setTimeout(() => {
    emailSubject.textContent = email.subject;
    emailFrom.textContent = email.from;
    emailBody.textContent = email.body;
    emailCard.classList.remove('fade-out');
  }, 150);

  feedback.textContent = '';
  updateProgress();
  startTimer();
}

/**
 * Update score display
 */
function updateScore() {
  scoreValue.textContent = currentScore;
}

/**
 * Update email progress display
 */
function updateProgress() {
  emailProgress.textContent = `${currentEmailIndex + 1}/${filteredEmails.length}`;
}

/**
 * Start countdown timer
 */
function startTimer() {
  timeLeft = timerDuration;
  timeValue.textContent = timeLeft;
  timerElement.classList.remove('warning');
  
  clearInterval(timerInterval);
  timerInterval = setInterval(() => {
    timeLeft--;
    timeValue.textContent = timeLeft;
    
    // Show warning when time is low
    if (timeLeft <= 5) {
      timerElement.classList.add('warning');
    }
    
    // Time's up
    if (timeLeft <= 0) {
      clearInterval(timerInterval);
      handleTimeout();
    }
  }, 1000);
}

/**
 * Display explanation panel after answer
 */
function showExplanation(isCorrect) {
  const email = filteredEmails[currentEmailIndex];
  
  // Create explanation HTML
  const icon = isCorrect ? '‚úÖ' : '‚ùå';
  const resultClass = isCorrect ? 'correct' : 'wrong';
  
  let explanationHTML = `
    <div class="explanation-panel ${resultClass}">
      <div class="explanation-header">
        <span class="explanation-icon">${icon}</span>
        <span>${isCorrect ? 'Correct!' : 'Wrong!'}</span>
      </div>
      <div class="explanation-title">Why?</div>
      <ul class="explanation-list">
  `;
  
  email.explanation.forEach(reason => {
    explanationHTML += `<li>${reason}</li>`;
  });
  
  explanationHTML += `
      </ul>
      <button class="btn-next" id="btnNext">Next Email ‚Üí</button>
    </div>
  `;
  
  explanationPanel.innerHTML = explanationHTML;
  explanationPanel.classList.remove('hidden');
  
  // Add event listener to Next button
  document.getElementById('btnNext').addEventListener('click', () => {
    currentEmailIndex++;
    showEmail();
  });
}

/**
 * Handle user answer selection
 */
function handleAnswer(userSaidPhishing) {
  if (!buttonsEnabled) return;
  
  // Disable buttons and stop timer
  buttonsEnabled = false;
  btnLegit.disabled = true;
  btnPhishing.disabled = true;
  clearInterval(timerInterval);
  
  const email = filteredEmails[currentEmailIndex];
  const isCorrect = userSaidPhishing === email.isPhishing;
  
  // Update score
  if (isCorrect) {
    currentScore += 10;
    feedback.textContent = "Correct! üéâ";
    feedback.className = 'feedback correct';
  } else {
    currentScore -= 5;
    feedback.textContent = "Wrong! ‚ö†Ô∏è";
    feedback.className = 'feedback wrong';
  }
  
  updateScore();
  
  // Show explanation panel after brief delay
  setTimeout(() => {
    showExplanation(isCorrect);
  }, 800);
}

/**
 * Handle timer timeout
 */
function handleTimeout() {
  if (!buttonsEnabled) return;
  
  // Disable buttons
  buttonsEnabled = false;
  btnLegit.disabled = true;
  btnPhishing.disabled = true;
  
  // Update score (penalty for timeout)
  currentScore -= 5;
  feedback.textContent = "Time's up! ‚è∞";
  feedback.className = 'feedback wrong';
  updateScore();
  
  // Show explanation as wrong answer
  setTimeout(() => {
    showExplanation(false);
  }, 800);
}

/**
 * End game and show results
 */
function endGame() {
  clearInterval(timerInterval);
  gameScreen.classList.add('hidden');
  gameOverScreen.classList.remove('hidden');
  
  finalScore.textContent = currentScore;
  
  // Determine rank message
  if (currentScore > 70) {
    rankMessage.textContent = "üõ°Ô∏è Security Expert!";
    rankMessage.style.color = "#00ff88";
  } else {
    rankMessage.textContent = "üîê Needs Training";
    rankMessage.style.color = "#ff4444";
  }
  
  // Check for new high score
  if (isNewHighScore(currentScore)) {
    newHighScoreSection.classList.remove('hidden');
  } else {
    newHighScoreSection.classList.add('hidden');
  }
}

/**
 * Restart game - return to start screen
 */
function restartGame() {
  gameOverScreen.classList.add('hidden');
  startScreen.classList.remove('hidden');
  nameInput.value = '';
}

/**
 * Save high score with player name
 */
function saveScore() {
  const playerName = nameInput.value.trim() || 'Anonymous';
  saveHighScore(playerName, currentScore);
  newHighScoreSection.classList.add('hidden');
  
  // Show success message
  const successMsg = document.createElement('div');
  successMsg.textContent = '‚úÖ High score saved!';
  successMsg.style.color = '#00ff88';
  successMsg.style.fontSize = '1.2em';
  successMsg.style.marginTop = '20px';
  gameOverScreen.insertBefore(successMsg, btnRestart);
  
  setTimeout(() => {
    successMsg.remove();
  }, 3000);
}

// ============================================
// EVENT LISTENERS
// ============================================
btnLegit.addEventListener('click', () => handleAnswer(false));
btnPhishing.addEventListener('click', () => handleAnswer(true));
btnRestart.addEventListener('click', restartGame);
btnSaveScore.addEventListener('click', saveScore);

// Allow Enter key to save score
nameInput.addEventListener('keypress', (e) => {
  if (e.key === 'Enter') {
    saveScore();
  }
});

// ============================================
// INITIALIZE GAME
// ============================================
// Load high score when page loads
loadHighScore();
</script>
</body>
</html>
